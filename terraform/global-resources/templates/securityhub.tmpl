## This file is automatically generated based on what regions are enabled in an AWS account
## and what regions SecurityHub is available in.

%{ for enabled_region in enabled ~}
%{ if contains(service, enabled_region) ~}
# Enable SecurityHub in each available region
resource "aws_securityhub_account" "${enabled_region}" {
  provider = aws.${enabled_region}
}

# Enable Standard: AWS Foundational Security Best Practices
resource "aws_securityhub_standards_subscription" "${enabled_region}-aws-foundational" {
  provider      = aws.${enabled_region}
  depends_on    = [aws_securityhub_account.${enabled_region}]
  standards_arn = "arn:aws:securityhub:${enabled_region}::standards/aws-foundational-security-best-practices/v/1.0.0"
}

# Enable Standard: CIS AWS Foundations
resource "aws_securityhub_standards_subscription" "${enabled_region}-cis" {
  provider      = aws.${enabled_region}
  depends_on    = [aws_securityhub_account.${enabled_region}]
  standards_arn = "arn:aws:securityhub:::ruleset/cis-aws-foundations-benchmark/v/1.2.0"
}

# Enable Standard: PCI DSS v3.2.1
resource "aws_securityhub_standards_subscription" "${enabled_region}-pci" {
  provider      = aws.${enabled_region}
  depends_on    = [aws_securityhub_account.${enabled_region}]
  standards_arn = "arn:aws:securityhub:${enabled_region}::standards/pci-dss/v/3.2.1"
}

%{ else ~}
%{ endif ~}
%{ endfor ~}
