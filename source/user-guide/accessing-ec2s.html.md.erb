---
title: Accessing EC2s using bastions
last_reviewed_on: 2021-09-06
review_in: 3 months
---

# <%= current_page.data.title %>

## Overview

Member accounts can use the [Modernisation Platform bastion module](https://github.com/ministryofjustice/modernisation-platform-terraform-bastion-linux) to build a bastion configured with user and user SSH keys.
These steps outline the AWS and SSH configurations required for users to connect to the bastion and on to their desired EC2 within their environment.

## Required configurations to connect to the bastion

1) Ensure AWS CLI v2 is installed locally

2) Add the following to your `~/.aws/config` configuration file. Give the profile name a relevant name for example `[profile glados-test-developer]` and add the corresponding AWS account number:

```
[profile glados-test-developer]
sso_start_url = https://moj.awsapps.com/start
sso_region = eu-west-2
sso_account_id = 123456789
sso_role_name = modernisation-platform-developer
region = eu-west-2
output = json

```

3) Add the example in this step to your `~/.ssh/config` file. Give the host a relevant name, for example `glados-test-bastion`. Replace the `User` and the `IdentityFile` path - it is the local path to the corresponding private key of the public key added to the `bastion_linux.json` file set up as part of the [Modernisation Platform bastion module](https://github.com/ministryofjustice/modernisation-platform-terraform-bastion-linux) build. Replace the `target` with the bastion instance ID in the corresponding AWS account and include the AWS profile created in the previous step:

```
Host glados-test-bastion
     IdentityFile ~/.ssh/id_rsa
     User jane
     ProxyCommand sh -c "aws ssm start-session --target i-123456789 --document-name AWS-StartSSHSession --parameters 'portNumber=%p' --profile glados-test-developer --region eu-west-2"

```

4) Log in to SSO using the following command:

 ```
 aws sso login --profile glados-test-developer

 ```

5) SSH to the bastion using the following command:

```
ssh glados-test-bastion

```

## Using the Bastion as a jump server to access Linux EC2s

In addition to the configuration added to the `~/.ssh/config` file in the step above, add the following to use the bastion as a jump server.
Replace the Host `instanceip` with the ip address of the EC2 you need to connect to. The `IdentityFile` is the local path to the private key assigned to the EC2 instance you are connecting to.

```
Host instanceip
    IdentityFile glados-test.pem
    User ec2-user
    ProxyCommand ssh -W %h:%p glados-test-bastion

```

After adding the configuration above, SSH to your EC2 with the command below:

```
ssh instanceip

```

## Port forwarding to EC2 using the bastion

Replace ports, IP adddresses, and name of Host as appropriate.

```
ssh -L 8000:11.11.11.11:80 glados-test-bastion

```
