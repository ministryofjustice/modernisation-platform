---
owner_slack: "#modernisation-platform"
title: Disabling network access if required
last_reviewed_on: 2024-02-14
review_in: 6 months or when is resolved.
---

# <%= current_page.data.title %>

## Overview

There may be occasions where there is a network attack on Modernisation Platform environments that could require a way of stopping access. This document lists the possible solutions to the issue.

[NOTE]

> All the steps below assume you can access the system through the AWS console and do not require changes to the terraform code. This is based on initial speed of access. There may be times when amending the code is quicker but this is not included here.

## Establish if there is an attack or unwanted access

Establish if there is unwanted access or an attack taking place by checking the details on cloudwatch in both core-network-services and core-logging. It should be obvious from the contents of the logs.

On core-network-services examine the contents, for production services, of

- fw-live-data-inline-inspection-logs-ulpiqfaq
- live\*data-vpc-flow-logs-qoa52v4z
- external-inspection-flow-logs

or the following for non-production services

- non_live_data-vpc-flow-logs-fro8eqat
- fw-non-live-data-inline-inspection-logs-ks3lnpsk

On core-logging examine the contents, for production services, of

- live_data-vpc-flow-logs
  or the following for non-production services
- non_live_data-vpc-flow-logs

## If an issue has been established

You need to then logon to the environment for which there is an issue. For example if it is on NOMIS Combined Reporting Preproduction (nomis-combined-reporting-production) then connect to the core-vpc-preproduction. In this case it would be the hmpps VPC.

1. Connect to the service involved.
2. INITIALLY detatch the environment from the VPC using Actions and Delete VPC. It might not be possible to delete this as there will be networked interfaces attached which need to be noted and deleted. In this case amending the code may be more appropriate. In the above example there are 166 preproduction network interfaces to be removed.

[CAUTION]

> **NOTE THIS IS DRASTIC AND LIKELY TO CAUSE OTHER issues in stopping all applcations attached to this VPC.**

3. Check the log again following the steps above.

## Detatching the VPC didn't work

In most cases removing the VPC from the environment will stop connections but it is a drastic step. If this does not work follow the steps listed below. Again a smaple is shown below the text.

[NOTE]

> To stop connections you will need to access one of the core-vpc environments:

- core-vpc-production
- core-vpc-development
- core-vpc-test
- core-vpc-preproduction
- core-vpc-sandbox

Connect to the appropriate environment (so for production go to core-vpc-production) and

1. Select the Subnet name under "VPC"
2. Pick the actions button and block the offending IP addresses through amending the route table. To do this change the route to one that has no network access. The new root table will be called block-all-access. The root table ID will not be known until the build is complete. 

[CAUTION]

> **THIS WILL IMPACT _ALL ENVIRONMENTS_ CONNECTED TO THIS SUBNET SO TAKE CARE.**

Do this for all subnets :

- general-data
- general-private
- general-public
- protected
- transit-gateway

[NOTE]

> The subnet names will be proceeded by the service name (e.g. hmpps-development-) and followed by 1 of -eu-west-2a, -eu-west-2b, -eu-west-2c. So a name may be hmpps-preproduction-general-private-eu-west-2b, as an example.

## Major issue and we need to stop all access

This is when there is an issue that is access from anywhere. In this instance we need to stop all access to the transit gateway (TGW).

In this instance we would remove the access to the TGW from the access for each area impacted. A note should be kept of the current TGW ID so that it can be re-instated at a later date.

To do this :

1. connect to the transit gateway attachments section in the VPC list (transit gateway is quite a way down the screen on the left)
2. pick the option you want and select Actions, Delete transit gateway attachment
3. select the gateway to remove (only one should be listed) and type "delete" in the space and click the Delete button

The transit gateway will be removed. 
