---
owner_slack: "#modernisation-platform"
title: Disaster Recovery Process
last_reviewed_on: 2024-01-24
review_in: 6 months
---

# <%= current_page.data.title %>

# Disaster Recovery

##

If this is in hours, create a huddle / meet. Outside of hours, call the second member of staff on call and post to the channel.

## Disaster Recovery Types

## Contact AWS

Firstly, contact AWS, understanding if this is an outage for 1 hour or 1 month will dictate the next steps to take.

## Types

If you are reading this, I hope its just to update the page, and not to follow it.

- London has been lost but returning soon. [Click here]().
- London has been lost, and services need to migrate. [Click here]().

## Disaster Recovery Running outside of London.

If the London infrastructure is to be down for the forseable future, running from another region is the next step. Identifying the region based infrastructure and its replications status will be next

### Cross Region Infrastructure in the Platform

| Technology      	| Information                                    	| Replicated? 	| Replication Region 	|
|-----------------	|------------------------------------------------	|-------------	|--------------------	|
| S3              	| Contains the platforms terraform state files.  	| Yes         	| eu-west-1          	|
| KMS             	| Contains encryption kes for the platform.      	| No          	| -                  	|
| Secrets Manger  	| Contains platform secrets.                     	| Yes         	| eu-west-1          	|
| IAM Policys     	| Across all regions.                            	| -           	| -                  	|
| DNS             	| Across all regions.                            	| -           	| -                  	|
| VPC             	| No VPCs currently exist for DR, only reserved. 	| -           	| -                  	|
| Firewall        	|                                                	|             	|                    	|
| Transit Gateway 	|                                                	|             	|                    	|
| NACLS           	|                                                	|             	|                    	|
| Subnets         	|                                                	|             	|                    	|
| Dynamo Disable    | Check



### Contact AWS

Contact AWS using the following steps
- Raise a ticket, highest prioirty.
- Contact our AWS representative for an update on the situation.

## Platform rebuild

This is a large undertaking, and has not been tested but discussed in the team.


### VPCs and Subnets

1. Clone the mod-platform repo, change region. 
2. Core VPC rebuild. Provider would need to be eu-west-1. 
3. Core Netowrking.

With the infrasturcture in London no longer avaiable we would use the original ranges. 

### Transit Gateway

1. Rebuild Transit gateway in new region, code in core-network-services.

### Firewall

Located in the Core-Network-Services account, DNS, networking and other network related infrastructure will be down. 

The firewall rules can be located here - https://github.com/ministryofjustice/modernisation-platform/tree/main/terraform/environments/core-network-services/firewall-rules

Live data & non live data.

Peer the new Transit grateway build in eu-west-1 to the MOJ transitgateway that is in eu-west-2 ???

### Account dependencies


| Account      	| Information                                    	| 
|-----------------	|------------------------------------------------	|
| Core-Shared-Services            | Creates the core shared services account resources	  	| 
| Core-Network-Services           | Creates the core networking account resources	      	|
| Core-Logging  	              | Creates the core logging account resources	                    	| 
| Core-Security     	          | Creates the core security account resources	                           	| 
| Cloud-Platform-Transit-Gateways | Across all regions.                            	| 
| Core-VPC-*                      | Creates the core VPC resources in the VPC accounts	 	| 
| Modernisation-Platform          | Creates key resources such as S3 state buckets for the platform	|


## Customer Dependancies

Core-shares-services - Required by customers. AMI. Backup region.


## References
* [https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-console.html](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-console.html)
* [https://github.com/ministryofjustice/modernisation-platform/blob/main/terraform/modernisation-platform-account/iam.tf](https://github.com/ministryofjustice/modernisation-platform/blob/main/terraform/modernisation-platform-account/iam.tf)

