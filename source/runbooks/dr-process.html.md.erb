---
owner_slack: "#modernisation-platform"
title: Disaster Recovery Process
last_reviewed_on: 2024-01-24
review_in: 6 months
---

# <%= current_page.data.title %>
## Contact AWS

Firstly, contact AWS, understanding if this is an outage for 1 hour or 1 month will dictate the next steps to take.

Login to the Modernisation Platform account, and raise the highest level severity ticket, whilst also enganging with our AWS representative in this channel **fill in**

If this is in hours, create a huddle / meet. Outside of hours, call the second member of staff on call and post to the channel. With the PagerDuty alerts, incident channels will be created, too many to follow, so make a lead channel to coordinate.

## Disaster Recovery Types

If you are reading this, I hope its just to update the page, and not to follow it.

**Let’s work the problem, people. Let’s not make things worse by guessing.**

- London has been lost but returning soon. [Click here]().
- London has been lost, **and services need to migrate**. [Click here]().

## London has been lost but returning soon.

### Contact AWS

Working with AWS, find out ETAs surrounding full and partial returns of infrastrucutre. Be aware, whilst the infrastructure may return, whatever is running on it may not jump back to life, rebooting, and troubleshooting will be needed.

### Priority list

If theres limited availiblity, which is a possibility, these are the priority accounts.




| Account      	| Information                                    	| 
|-----------------	|------------------------------------------------	|
| Core-Shared-Services            | Creates the core shared services account resources.	  	| 
| Core-Network-Services           | Creates the core networking account resources, this is the highest priority.	      	|
| Core-Logging  	              | Creates the core logging account resources	                    	| 
| Core-Security     	          | Creates the core security account resources	                           	| 
| Cloud-Platform-Transit-Gateways | Across all regions.                            	| 
| Core-VPC-*                      | Creates the core VPC resources in the VPC accounts, needed after the core-networking-services.	 	| 
| Modernisation-Platform          | Creates key resources such as S3 state buckets for the platform	|

### Test Accounts

If there is limited avaiailbity, power off all infrastrucutre in the test accounts. All are useless until the platform is running.

### Test Accounts



## Disaster Recovery Running outside of London.

If the London infrastructure is to be down for the forseable future, running from another region is the next step. Identifying the region based infrastructure and its replications status will be next

### Cross Region Infrastructure in the Platform

| Technology      	| Information                                    	| Replicated? 	| Replication Region 	|
|-----------------	|------------------------------------------------	|-------------	|--------------------	|
| S3              	| Contains the platforms terraform state files.  	| Yes         	| eu-west-1          	|
| KMS             	| Contains encryption kes for the platform.      	| No          	| -                  	|
| Secrets Manger  	| Contains platform secrets.                     	| Yes         	| eu-west-1          	|
| IAM Policys     	| Across all regions.                            	| -           	| -                  	|
| DNS             	| Across all regions.                            	| -           	| -                  	|
| VPC             	| No VPCs currently exist for DR, only reserved. 	| -           	| -                  	|
| Firewall        	| Not cross region.                                               	|             	|                    	|
| Transit Gateway 	| Not cross region.                                               	|             	|                    	|
| NACLS           	| Not cross region.                                               	|             	|                    	|
| Subnets         	| Not cross region.                                               	|             	|                    	|
| Dynamo Disable    | Check



### Contact AWS

As previously mentioned, contact AWS using the following steps

- Raise a ticket, highest prioirty.
- Contact our AWS representative for an update on the situation.
- Organise updates, if the situation changes, our approach might need to. 

## Platform rebuild - Networking

This is a large undertaking, and has not been tested but discussed within the team.

### Networking Overview

Our [Networking Diagram](../concepts/networking/networking-diagram.html) shows a high level view of how shared
VPCs are connected. 

Our [Networking Approach](../concepts/networking/networking-approach.html) discusses and 
contains a detailed view of our shared VPCs.

Our [Transit Gateway](../how-vpcs-access-the-internet.html) and how VPCs access the internet.


## Stages

### VPCs and Subnets

1. Clone the mod-platform repo, change region in code. Whilst its as simple as a find and replace, modules are called and need changing, either locally and refrenced locally, or in the module and pushed to git.
2. Core VPC rebuild. Provider would need to be eu-west-1, so check the permissions you have in that region with the credentials you are using. E.g. https://moj.awsapps.com/start/ when getting your credentials from here, make sure the region is correct.
3. Core Netowrking would be the next to run terraform on, checking the code and modules it uses for region refrences and changing them.

**With the infrasturcture in London no longer avaiable we would use the original ranges**

### Transit Gateway

1. Rebuild Transit gateway in new region, code in core-network-services located here. - https://github.com/ministryofjustice/modernisation-platform/tree/main/terraform/environments/core-network-services 

### Firewall

We make use of AWS Network Firewalls in two ways. First, we use a centralised inspection VPC to control traffic entering and exiting the Modernisation Platform to and from internal Ministry of Justice services. Second, we use inline-inspection in our egress VPCs to control traffic exiting the Modernisation Platform to the internet.

Located in the Core-Network-Services account, DNS, networking and other network related infrastructure will be down. 

The firewall rules can be located here - https://github.com/ministryofjustice/modernisation-platform/tree/main/terraform/environments/core-network-services/firewall-rules

Live data & non live data.

Peer the new Transit grateway build in eu-west-1 to the MOJ transitgateway that is in eu-west-2 ???

### Account dependencies


| Account      	| Information                                    	| 
|-----------------	|------------------------------------------------	|
| Core-Shared-Services            | Creates the core shared services account resources, AMIs and other services customers require are based in here.	  	| 
| Core-Network-Services           | Creates the core networking account resources, and contains the transit gateway terraform, as well as firewall rules.	      	|
| Core-Logging  	              | Creates the core logging account resources, not essential but a part of the platform.	                    	| 
| Core-Security     	          | Creates the core security account resources	                           	| 
| Cloud-Platform-Transit-Gateways | Across all regions.                            	| 
| Core-VPC-*                      | Creates the core VPC resources in the VPC accounts	 	| 
| Modernisation-Platform          | Creates key resources such as S3 state buckets for the platform	|


## Customer Dependencies

### Core-shares-services

Required by customers. AMI. Backup region. Repos.



## Things I need to check

- What permissions do we have building in other regions?
- Perhaps a list of modules which will need changing ? Some have hard coded providers.. which ones we would need to change.



## References
* [https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-console.html](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-console.html)
* [https://github.com/ministryofjustice/modernisation-platform/blob/main/terraform/modernisation-platform-account/iam.tf](https://github.com/ministryofjustice/modernisation-platform/blob/main/terraform/modernisation-platform-account/iam.tf)

